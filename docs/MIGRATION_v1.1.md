# Миграция на версию 1.1.0

## Новые возможности

В версии 1.1.0 добавлены три новых поля для более полного анализа деловых диалогов:

### 1. Желаемые сроки (`desired_timeline`)
AI автоматически извлекает упоминания о желаемых сроках реализации проекта:
- "через 2 месяца"
- "до конца квартала"
- "перед инвентаризацией"
- и т.д.

**Тип**: `Optional[str]` (может быть `null` если сроки не упомянуты)

### 2. Бюджет/Стоимость (`budget_range`)
AI извлекает информацию о бюджете или ожиданиях по стоимости:
- "ограниченный бюджет"
- "облачная подписка предпочтительнее"
- "около 500 тысяч рублей"
- и т.д.

**Тип**: `Optional[str]` (может быть `null` если бюджет не упомянут)

### 3. Основные требования (`core_requirements`)
Список ключевых требований к финальному продукту - что ОБЯЗАТЕЛЬНО должно быть реализовано:
- "работа со штрихкодами"
- "синхронизация между складами"
- "мобильное приложение для сотрудников"
- "интеграция с 1С"
- и т.д.

**Тип**: `List[str]` (может быть пустым списком)

## Обратная совместимость

✅ **Полная обратная совместимость сохранена**

### Старый кэш
Старые кэшированные результаты (без новых полей) будут работать благодаря `Optional` типам и значениям по умолчанию:
- `desired_timeline` = `None`
- `budget_range` = `None`  
- `core_requirements` = `[]` (пустой список)

### Шаблоны
HTML шаблон использует условные блоки `{% if %}`, поэтому:
- Если новые поля отсутствуют или пустые - секции не отображаются
- Старые отчёты остаются корректными

## Изменённые файлы

1. **utils/schema.py**
   - Добавлены 3 новых поля в `ReportData`
   - Обновлён `REPORT_SCHEMA_DESCRIPTION`

2. **utils/ai_processor.py**
   - Обновлён `system_prompt` с инструкциями по извлечению новых полей

3. **templates/report_template.html**
   - Добавлена секция "Желаемые сроки и стоимость"
   - Добавлена секция "Основные требования к продукту"

4. **templates/style.css**
   - Новые стили для `.requirements-box`
   - Цветовые акценты `.highlight-timeline` и `.highlight-budget`

## Использование

После обновления проект работает так же, как и раньше:

```bash
# Стандартный запуск
python main.py

# С вашим файлом
python main.py --input your_transcript.txt

# Без кэша (чтобы пересоздать отчёт с новыми полями)
python main.py --no-cache
```

## Обновление существующих отчётов

Если вы хотите пересоздать старые отчёты с новыми полями:

```bash
# Вариант 1: Удалить кэш и пересоздать
rm cache/ai_outputs/*
python main.py --input your_old_transcript.txt

# Вариант 2: Использовать --no-cache
python main.py --input your_old_transcript.txt --no-cache
```

## Пример вывода в отчёте

### Желаемые сроки и стоимость
```
Желаемые сроки:    Через два месяца, до плановой инвентаризации
Бюджет/Стоимость:  Ограниченный бюджет, предпочтительна облачная модель с ежемесячной оплатой
```

### Основные требования к продукту
Что точно должно быть в финальном продукте:
- Учёт товаров в режиме реального времени
- Работа со штрихкодами
- Интеграция между тремя складами
- Мобильное приложение для сотрудников склада
- Интеграция с 1С

## Примеры JSON ответа от AI

### С новыми полями
```json
{
  "client_name": "Дмитрий Петров",
  "topic": "Автоматизация складского учёта",
  "main_request": "Система для управления тремя складами с синхронизацией данных",
  "sentiment": {
    "label": "positive",
    "score": 4
  },
  "summary": "Клиент ищет решение для автоматизации складского учёта...",
  "key_points": ["15000 SKU", "3 склада", "25 сотрудников"],
  "next_steps": ["Подготовить КП", "Запланировать демо"],
  "desired_timeline": "Через два месяца, до плановой инвентаризации",
  "budget_range": "Ограниченный бюджет, предпочтительна облачная модель",
  "core_requirements": [
    "Учёт товаров в реальном времени",
    "Работа со штрихкодами",
    "Синхронизация между складами",
    "Мобильное приложение",
    "Интеграция с 1С"
  ]
}
```

### Без упоминания новых полей
```json
{
  "client_name": "Иван Иванов",
  "topic": "Общая консультация",
  "main_request": "Узнать о возможностях системы",
  "sentiment": {
    "label": "neutral",
    "score": 3
  },
  "summary": "Предварительная консультация...",
  "key_points": ["..."],
  "next_steps": ["..."],
  "desired_timeline": null,
  "budget_range": null,
  "core_requirements": []
}
```

## Вопросы и проблемы

### Старый кэш не работает?
Если у вас возникли проблемы с валидацией старого кэша:
1. Очистите директорию `cache/ai_outputs/`
2. Запустите с `--no-cache`

### Новые поля не заполняются?
AI может не найти информацию о сроках/бюджете/требованиях, если:
- В диалоге эти темы не обсуждались
- Упоминания слишком неявные

В этом случае поля будут `null` или пустыми, что нормально.

### Хочу изменить стиль отображения?
Отредактируйте:
- `templates/report_template.html` - структура секций
- `templates/style.css` - визуальное оформление

## Дальнейшее развитие

Эта же методология применима для добавления любых новых полей:

1. Обновите `utils/schema.py`
2. Обновите AI промпт в `utils/ai_processor.py`
3. Обновите `templates/report_template.html`
4. При необходимости обновите `templates/style.css`

Подробнее см. README.md раздел "Адаптация под свои нужды".
